<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8"/>
	<title>Minimal BubbleTree Demo</title>
	<script type="text/javascript" src="./lib/jquery-1.5.2.min.js"></script>
	<script type="text/javascript" src="./lib/jquery.history.js"></script>
	<script type="text/javascript" src="./lib/jquery.tooltip.min.js"></script>	
	<script type="text/javascript" src="./lib/raphael.js"></script>
	<script type="text/javascript" src="./lib/vis4.js"></script>
	<script type="text/javascript" src="./lib/Tween.js"></script>
	<script type="text/javascript" src="./build/bubbletree.js"></script>
	<script type="text/javascript" src="http://assets.openspending.org/openspendingjs/master/lib/aggregator.js"></script>	
	<link rel="stylesheet" type="text/css" href="./build/bubbletree.css" />
	<script type="text/javascript" src="./styles/cofog.js"></script>
	
	
	<script type="text/javascript">
       
		$(function() {

			
			var data = {
    "label": "Міський бюджет 2013",
    "children": [{
        "label": "Правоохоронна діяльність та забезпечення безпеки держави ",
        "children": [],
        "amount": 0
    }, {
        "label": "Освіта ",
        "children": [{
            "label": "Дошкільні заклади освіти ",
            "amount": 110630900
        }, {
            "label": "Загальноосвітні школи (в т. ч. школа-дитячий садок, інтернат при школі), спеціалізовані школи, ліцеї, гімназії, колегіуми ",
            "amount": 162202400
        }, {
            "label": "Загальноосвітні спеціалізовані школи-інтернати з поглибленим вивченням окремих предметів і курсів для поглибленої підготовки дітей в галузі науки і мистецтв, фізичної культури і спорту, інших галузях, ліцеї з посиленою військово-фізичною підготовкою ",
            "amount": 6583200
        }, {
            "label": "Позашкільні заклади освіти, заходи із позашкільної роботи з дітьми ",
            "amount": 7994500
        }, {
            "label": "Методична робота, інші заходи у сфері народної освіти ",
            "amount": 1821500
        }, {
            "label": "Централізовані бухгалтерії обласних, міських, районних відділів освіти ",
            "amount": 3660700
        }, {
            "label": "Інші заклади освіти ",
            "amount": 1374500
        }, {
            "label": "Допомога дітям-сиротам та дітям, позбавленим батьківського піклування, яким виповнюється 18 років ",
            "amount": 77800
        }],
        "amount": 294345500
    }, {
        "label": "Охорона здоров'я ",
        "children": [{
            "label": "Лікарні ",
            "amount": 40810000
        }, {
            "label": "Пологові будинки ",
            "amount": 37109000
        }, {
            "label": "Поліклініки і амбулаторії (крім спеціалізованих поліклінік та загальних і спеціалізованих стоматологічних поліклінік) ",
            "amount": 57517600
        }, {
            "label": "Загальні і спеціалізовані стоматологічні поліклініки ",
            "amount": 10877000
        }, {
            "label": "Інші заходи по охороні здоров'я ",
            "amount": 1370000
        }, {
            "label": "Централізовані бухгалтерії ",
            "amount": 372000
        }],
        "amount": 148055600
    }, {
        "label": "Соціальний захист та соціальне забезпечення ",
        "children": [{
            "label": "Інші видатки на соціальний захист населення ",
            "amount": 605100
        }, {
            "label": "Утримання центрів соціальних служб для сім'ї, дітей та молоді ",
            "amount": 1883200
        }, {
            "label": "Програми і заходи центрів соціальних служб для сім'ї, дітей та молоді ",
            "amount": 123200
        }, {
            "label": "Соціальні програми і заходи державних органів у справах молоді ",
            "amount": 68600
        }, {
            "label": "Територіальні центри соціального обслуговування (надання соціальних послуг) ",
            "amount": 6870000
        }, {
            "label": "Фінансова підтримка громадських організацій інвалідів і ветеранів ",
            "amount": 180000
        }],
        "amount": 9730100
    }, {
        "label": "Житлово-комунальне господарство ",
        "children": [{
            "label": "Капітальний ремонт житлового фонду місцевих органів влади ",
            "amount": 688000
        }, {
            "label": "Дотація житлово-комунальному господарству ",
            "amount": 107400
        }, {
            "label": "Теплові мережі ",
            "amount": 500000
        }, {
            "label": "Водопровідно-каналізаційне господарство ",
            "amount": 900000
        }, {
            "label": "Благоустрій міст, сіл, селищ ",
            "amount": 12609100
        }, {
            "label": "Берегоукріплювальні роботи ",
            "amount": 650000
        }, {
            "label": "Комбінати комунальних підприємств, районні виробничі об'єднання та інші підприємства, установи та організації житлово-комунального господарства ",
            "amount": 9512000
        }, {
            "label": "Ремонтно-будівельні організації житлово-комунального господарства ",
            "amount": 1365000
        }],
        "amount": 26331500
    }, {
        "label": "Культура і мистецтво ",
        "children": [{
            "label": "Бібліотеки ",
            "amount": 4044000
        }, {
            "label": "Палаци і будинки культури, клуби та інші заклади клубного типу ",
            "amount": 6156700
        }, {
            "label": "Школи естетичного виховання дітей ",
            "amount": 14642500
        }, {
            "label": "Інші культурно-освітні заклади та заходи ",
            "amount": 2487200
        }],
        "amount": 27330400
    }, {
        "label": "Засоби масової інформації ",
        "children": [{
            "label": "Періодичні видання (газети та журнали) ",
            "amount": 656200
        }],
        "amount": 656200
    }, {
        "label": "Фізична культура і спорт ",
        "children": [{
            "label": "Проведення навчально-тренувальних зборів і змагань ",
            "amount": 170000
        }, {
            "label": "Проведення навчально-тренувальних зборів і змагань з неолімпійських видів спорту ",
            "amount": 30000
        }, {
            "label": "Утримання та навчально-тренувальна робота дитячо-юнацьких спортивних шкіл ",
            "amount": 5439000
        }, {
            "label": "Фінансова підтримка спортивних споруд ",
            "amount": 580000
        }],
        "amount": 6219000
    }, {
        "label": "Будівництво ",
        "children": [{
            "label": "Капітальні вкладення ",
            "amount": 31615400
        }, {
            "label": "Проведення невідкладних відновлювальних робіт, будівництво та реконструкція загальноосвітніх навчальних закладів ",
            "amount": 300000
        }],
        "amount": 31915400
    }, {
        "label": "Сільське і лісове господарство, рибне господарство та мисливство ",
        "children": [{
            "label": "Землеустрій ",
            "amount": 200000
        }],
        "amount": 200000
    }, {
        "label": "Транспорт, дорожнє господарство, зв'язок, телекомунікації та інформатика ",
        "children": [{
            "label": "Компенсаційні виплати на пільговий проїзд автомобільним транспортом окремим категоріям громадян ",
            "amount": 2181500
        }, {
            "label": "Компенсаційні виплати за пільговий проїзд окремих категорій громадян на залізничному транспорті ",
            "amount": 650000
        }, {
            "label": "Компенсаційні виплати на пільговий проїзд електротранспортом окремим категоріям громадян ",
            "amount": 15774000
        }, {
            "label": "Інші заходи у сфері електротранспорту ",
            "amount": 550000
        }, {
            "label": "Видатки на проведення робіт, пов'язаних із будівництвом, реконструкцією, ремонтом та утриманням автомобільних доріг ",
            "amount": 50153100
        }, {
            "label": "Діяльність і послуги, не віднесені до інших категорій ",
            "amount": 100000
        }],
        "amount": 69408600
    }, {
        "label": "Інші послуги, пов'язані з економічною діяльністю ",
        "children": [{
            "label": "Підтримка малого і середнього підприємництва ",
            "amount": 35000
        }],
        "amount": 35000
    }, {
        "label": "Охорона навколишнього природного середовища та ядерна безпека ",
        "children": [{
            "label": "Охорона і раціональне використання земель ",
            "amount": 10000
        }],
        "amount": 10000
    }, {
        "label": "Запобігання та ліквідація надзвичайних ситуацій та наслідків стихійного лиха ",
        "children": [{
            "label": "Заходи з організації рятування на водах ",
            "amount": 1085000
        }],
        "amount": 1085000
    }, {
        "label": "Обслуговування боргу ",
        "children": [],
        "amount": 0
    }, {
        "label": "Цільові фонди ",
        "children": [{
            "label": "Охорона та раціональне використання природних ресурсів ",
            "amount": 2985000
        }, {
            "label": "Цільові фонди, утворені Верховною Радою Автономної Республіки Крим, органами місцевого самоврядування і місцевими органами виконавчої влади ",
            "amount": 5000000
        }],
        "amount": 7985000
    }, {
        "label": "Видатки, не віднесені до основних груп ",
        "children": [{
            "label": "Резервний фонд ",
            "amount": 4844900
        }, {
            "label": "Проведення виборів народних депутатів Верховної Ради Автономної Республіки Крим, місцевих рад та сільських, селищних, міських голів ",
            "amount": 110000
        }, {
            "label": "Дотації вирівнювання, що передаються з районних та міських (міст Києва і Севастополя, міст республіканського і обласного значення) бюджетів ",
            "amount": 33532300
        }, {
            "label": "Субвенція на утримання об'єктів спільного користування чи ліквідацію негативних наслідків діяльності об'єктів спільного користування ",
            "amount": 509900
        }, {
            "label": "Субвенція з державного бюджету місцевим бюджетам на виплату допомоги сім'ям з дітьми, малозабезпеченим сім'ям, інвалідам з дитинства, дітям-інвалідам та тимчасової державної допомоги дітям ",
            "amount": 190861800
        }, {
            "label": "Субвенція з державного бюджету місцевим бюджетам на надання пільг та житлових субсидій населенню на оплату електроенергії, природного газу, послуг тепло-, водопостачання і водовідведення, квартирної плати (утримання будинків і споруд та прибудинкових територій), вивезення побутового сміття та рідких нечистот ",
            "amount": 32242900
        }, {
            "label": "Субвенція з державного бюджету місцевим бюджетам на надання пільг з послуг зв'язку та інших передбачених законодавством пільг, в тому числі компенсації втрати частини доходів у зв'язку з відміною податку з власників транспортних засобів та відповідним збільшенням ставок акцизного податку з пального для фізичних осіб (крім пільг на одержання ліків, зубопротезування, оплату електроенергії, природного і скрапленого газу на побутові потреби, твердого та рідкого пічного побутового палива, послуг тепло-, водопостачання і водовідведення, квартирної плати (утримання будинків і споруд та прибудинкових територій), вивезення побутового сміття та рідких нечистот) та компенсацію за пільговий проїзд окремих категорій громадян ",
            "amount": 2044600
        }, {
            "label": "Субвенція з державного бюджету місцевим бюджетам на надання пільг та житлових субсидій населенню на придбання твердого та рідкого пічного побутового палива і скрапленого газу ",
            "amount": 74800
        }, {
            "label": "Субвенція з державного бюджету місцевим бюджетам на виплату державної соціальної допомоги на дітей-сиріт та дітей, позбавлених батьківського піклування, грошового забезпечення батькам-вихователям і прийомним батькам за надання соціальних послуг у дитячих будинках сімейного типу та прийомних сім'ях за принципом \"гроші ходять за дитиною\" ",
            "amount": 650000
        }, {
            "label": "Інші субвенції ",
            "amount": 4148248
        }],
        "amount": 269019448
    }],
    "amount": 892326748
};
function colorChildren(node, level) { // automatic coloring
			var level = typeof level == 'undefined' ? 0 : level;
			var numChildren = node.children.length;
                        //var level = node.nlevel; 
			var amount = node.amount;
			for (var i=0; i < numChildren ; i++) {
				var child = node.children[i] ;
 
				if (level == 0) {
					// random color for level 1 children
					child.color = vis4color.fromHSL(i/numChildren*360, .5, .5).x;
				}

				if (level > 0) {
					// children of level 2 will get a similar color of their parent
					child.color = vis4color.fromHex(node.color)
						.lightness('*'+(.2+Math.random()*.8)).x;
				}
				if (child.children && child.children.length > 0) colorChildren(child, level + 1);
			}
		}
		colorChildren(data);
var $tooltip = $('<div class="tooltip">Tooltip</div>');
			$('.bubbletree-wrapper').append($tooltip);
			//$tooltip.hide();
			var tooltip = function(event) {
			if (event.type == 'SHOW') {
				// show tooltip
				$tooltip.css({ 
					left: event.mousePos.x + 4, 
					top: event.mousePos.y + 4 
				});
				$tooltip.html(event.node.label+' <b>'+event.node.famount+'</b>');
				var bubble = event.target;
				
				$tooltip.show();
			} else {
				// hide tooltip
				$tooltip.hide();
			}
		};

			var getTooltip = function() {
				return this.getAttribute('tooltip');
			};
			
			var initTooltip = function(node, domnode) {
				domnode.setAttribute('tooltip', node.label+' &nbsp;<br /><big><b>'+node.famount+'</b></big>');
				
				vis4.log(domnode.getAttribute('tooltip'));
				
				$(domnode).tooltip({ delay: 200, bodyHandler: getTooltip });
			};
			new BubbleTree({
				data: data,
				container: '.bubbletree',
				initTooltip: initTooltip,
				tooltipCallback: tooltip,
				bubbleType: 'donut'
			});
			
		});
                                        
	</script>
</head>
<body>
	<div class="bubbletree-wrapper">
		<div class="bubbletree"></div>
	</div>
</body>
</html>
